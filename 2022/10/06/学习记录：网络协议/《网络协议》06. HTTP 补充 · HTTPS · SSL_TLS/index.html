<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="format-detection" content="telephone=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><link rel="icon" href="/images/icons/favicon-16x16.png?v=2.8.0" type="image/png" sizes="16x16"><link rel="icon" href="/images/icons/favicon-32x32.png?v=2.8.0" type="image/png" sizes="32x32"><meta name="description" content="HTTP&#x2F;1.1 协议的不足、HTTP&#x2F;2、HTTP&#x2F;3、HTTP 协议的安全问题、SPDY、HTTPS、SSL&#x2F;TLS、OpenSSL。">
<meta property="og:type" content="article">
<meta property="og:title" content="《网络协议》06. HTTP 补充 · HTTPS · SSL&#x2F;TLS">
<meta property="og:url" content="https://blog.lens-shrine.top/2022/10/06/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/%E3%80%8A%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E3%80%8B06.%20HTTP%20%E8%A1%A5%E5%85%85%20%C2%B7%20HTTPS%20%C2%B7%20SSL_TLS/index.html">
<meta property="og:site_name" content="镜坛">
<meta property="og:description" content="HTTP&#x2F;1.1 协议的不足、HTTP&#x2F;2、HTTP&#x2F;3、HTTP 协议的安全问题、SPDY、HTTPS、SSL&#x2F;TLS、OpenSSL。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://blog.lens-shrine.top/assets/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/06/d29e722c9791418cbe4009c60216dea4.png">
<meta property="og:image" content="https://blog.lens-shrine.top/assets/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/06/fcbca48699c444cbb760be0345c5189d.png">
<meta property="og:image" content="https://blog.lens-shrine.top/assets/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/06/553fd2ab9ab2404081dbc8e1abf00042.png">
<meta property="og:image" content="https://blog.lens-shrine.top/assets/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/06/f2fe7719f8dc4355a26e46ae71591cfd.png">
<meta property="og:image" content="https://blog.lens-shrine.top/assets/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/06/5f3fd03a4a1d4bca9de8cd2c96caf62c.png">
<meta property="og:image" content="https://blog.lens-shrine.top/assets/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/06/5d9fc86c421f419883580c426f6f79ca.png">
<meta property="og:image" content="https://blog.lens-shrine.top/assets/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/06/d3873a5d0db84068a442646aa4547e3e.png">
<meta property="og:image" content="https://blog.lens-shrine.top/assets/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/06/ef4432864de24f77ad5a71f4da3beef8.png">
<meta property="og:image" content="https://blog.lens-shrine.top/assets/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/06/59692cb33c7844d2a5153d165dabef2d.png">
<meta property="og:image" content="https://blog.lens-shrine.top/assets/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/06/13c2c08d06594cff8736b71c982c2843.png">
<meta property="og:image" content="https://blog.lens-shrine.top/assets/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/06/45e1af10bdf54f059432113e627cdbc3.png">
<meta property="og:image" content="https://blog.lens-shrine.top/assets/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/06/294da1460b764b9e871ab1d7eca220eb.png">
<meta property="og:image" content="https://blog.lens-shrine.top/assets/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/06/3183c5a96e514714ab6016b5e5f97268.png">
<meta property="og:image" content="https://blog.lens-shrine.top/assets/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/06/222183db4f5547cb88d63e4727c0ff4a.png">
<meta property="og:image" content="https://blog.lens-shrine.top/assets/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/06/c07d318897ca420aa55a006ea9f77229.png">
<meta property="og:image" content="https://blog.lens-shrine.top/assets/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/06/8089e2a8ef754372a1f7dbe021fb0f9e.png">
<meta property="og:image" content="https://blog.lens-shrine.top/assets/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/06/432079bcfe1a4199a412eb7ee33799ac.png">
<meta property="og:image" content="https://blog.lens-shrine.top/assets/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/06/cf2278dbc57a44b3850075e3f6201176.png">
<meta property="og:image" content="https://blog.lens-shrine.top/assets/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/06/4f0da17863844efb89e9782568ce4ef4.png">
<meta property="og:image" content="https://blog.lens-shrine.top/assets/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/06/9733cbb1f09e431eb2ec3522657eb618.png">
<meta property="og:image" content="https://blog.lens-shrine.top/assets/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/06/9a7699c3399f408d9e898ff83a36bbc0.png">
<meta property="og:image" content="https://blog.lens-shrine.top/assets/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/06/14cbc7e4a8d942aa9111148d4e3b8587.png">
<meta property="og:image" content="https://blog.lens-shrine.top/assets/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/06/b8287b7017324c7386a66b87711a44b2.png">
<meta property="og:image" content="https://blog.lens-shrine.top/assets/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/06/e756425dfd764cdfbc99aa5afbcaa491.png">
<meta property="og:image" content="https://blog.lens-shrine.top/assets/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/06/2af02c8cea194d86b5edb0e6386e3908.png">
<meta property="og:image" content="https://blog.lens-shrine.top/assets/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/06/5cc628fdc40e4e68ab7032ee40f8cf3c.png">
<meta property="og:image" content="https://blog.lens-shrine.top/assets/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/06/0d0f51dc81b74a6b95d0d324685e3503.png">
<meta property="og:image" content="https://blog.lens-shrine.top/assets/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/06/a0127996591c4a708340ddf4491135ac.png">
<meta property="og:image" content="https://blog.lens-shrine.top/assets/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/06/5bada67b8825425d92f6fb3ace9323a7.png">
<meta property="og:image" content="https://blog.lens-shrine.top/assets/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/06/a0113b991dfe470daedd836ddeb63e24.png">
<meta property="og:image" content="https://blog.lens-shrine.top/assets/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/06/76cf716e4a3c49fba7544627100f2829.png">
<meta property="article:published_time" content="2022-10-06T10:09:55.000Z">
<meta property="article:modified_time" content="2023-11-14T23:53:52.000Z">
<meta property="article:author" content="镜坛主">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://blog.lens-shrine.top/assets/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/06/d29e722c9791418cbe4009c60216dea4.png"><title>《网络协议》06. HTTP 补充 · HTTPS · SSL/TLS | 镜坛</title><link ref="canonical" href="https://blog.lens-shrine.top/2022/10/06/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/%E3%80%8A%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E3%80%8B06.%20HTTP%20%E8%A1%A5%E5%85%85%20%C2%B7%20HTTPS%20%C2%B7%20SSL_TLS/"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.12.1/css/all.min.css" type="text/css"><link rel="stylesheet" href="/css/index.css?v=2.8.0"><link rel="stylesheet" href="css/custom.css"><script>var Stun = window.Stun || {};
var CONFIG = {
  root: '/',
  algolia: undefined,
  assistSearch: undefined,
  fontIcon: {"prompt":{"success":"fas fa-check-circle","info":"fas fa-arrow-circle-right","warning":"fas fa-exclamation-circle","error":"fas fa-times-circle"},"copyBtn":"fas fa-copy"},
  sidebar: {"offsetTop":"20px","tocMaxDepth":6},
  header: {"enable":true,"showOnPost":true,"scrollDownIcon":true},
  postWidget: {"endText":true},
  nightMode: {"enable":true},
  back2top: {"enable":true},
  codeblock: {"style":"default","highlight":"dark","wordWrap":false},
  reward: false,
  fancybox: false,
  zoomImage: {"gapAside":"20px"},
  galleryWaterfall: undefined,
  lazyload: false,
  pjax: {"avoidBanner":true},
  externalLink: {"icon":{"enable":true,"name":"fas fa-external-link-alt"}},
  shortcuts: undefined,
  prompt: {"copyButton":"复制","copySuccess":"复制成功","copyError":"复制失败"},
  sourcePath: {"js":"js","css":"css","images":"images"},
};

window.CONFIG = CONFIG;</script><meta name="generator" content="Hexo 6.3.0"></head><body><div class="container" id="container"><header class="header" id="header"><div class="header-inner"><nav class="header-nav header-nav--fixed"><div class="header-nav-inner"><div class="header-nav-menubtn"><i class="fas fa-bars"></i></div><div class="header-nav-menu"><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/"><span class="header-nav-menu-item__icon"><i class="fas fa-home"></i></span><span class="header-nav-menu-item__text">首页</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/categories/"><span class="header-nav-menu-item__icon"><i class="fas fa-layer-group"></i></span><span class="header-nav-menu-item__text">分类</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/archives/"><span class="header-nav-menu-item__icon"><i class="fas fa-folder-open"></i></span><span class="header-nav-menu-item__text">归档</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/about/"><span class="header-nav-menu-item__icon"><i class="fas fa-thumbtack"></i></span><span class="header-nav-menu-item__text">关于</span></a></div></div><div class="header-nav-mode"><div class="mode"><div class="mode-track"><span class="mode-track-moon"></span><span class="mode-track-sun"></span></div><div class="mode-thumb"></div></div></div></div></nav><div class="header-banner" style="background: url(/images/backimg/SunsetClimbing.png) no-repeat center/cover;"><div class="header-banner-info"><div class="header-banner-info__title">镜 坛</div><div class="header-banner-info__subtitle">烛明香暗画楼深，满鬓青霜残雪思难任。</div></div><div class="header-banner-arrow"><div class="header-banner-arrow__icon"><i class="fas fa-angle-down"></i></div></div></div></div></header><main class="main" id="main"><div class="main-inner"><div class="content-wrap" id="content-wrap"><div class="content" id="content"><!-- Just used to judge whether it is an article page--><div id="is-post"></div><div class="post"><header class="post-header"><h1 class="post-title">《网络协议》06. HTTP 补充 · HTTPS · SSL/TLS</h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">发表于</span><span class="post-meta-item__value">2022-10-06</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">更新于</span><span class="post-meta-item__value">2023-11-15</span></span></div></header><div class="post-body"><p>@<a href="%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE">TOC</a></p>
<hr>
<blockquote>
<p>网络协议从入门到底层原理。</p>
</blockquote>

        <h1 id="1：HTTP-1-1-协议的不足"   >
          <a href="#1：HTTP-1-1-协议的不足" class="heading-link"><i class="fas fa-link"></i></a><a href="#1：HTTP-1-1-协议的不足" class="headerlink" title="1：HTTP&#x2F;1.1 协议的不足"></a>1：HTTP&#x2F;1.1 协议的不足</h1>
      <ul>
<li><p><strong>同一时间，一个连接只能对应一个请求</strong><br>针对同一个域名，大多数浏览器允许同时最多 6 个并发连接</p>
</li>
<li><p><strong>只允许客户端主动发起请求</strong><br>一个请求只能对应一个响应</p>
</li>
<li><p><strong>同一个会话的多次请求中，头信息会被重复传输</strong><br>通常会给每个传输增加 500~800 字节的开销<br>如果使用 Cookie，增加的开销有时会达到上千字节</p>
</li>
</ul>

        <h1 id="2：HTTP-2"   >
          <a href="#2：HTTP-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#2：HTTP-2" class="headerlink" title="2：HTTP&#x2F;2"></a>2：HTTP&#x2F;2</h1>
      <p>HTTP&#x2F;2，于 2015 年 5 月以 <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc7540" >RFC 7540</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> 正式发表</p>
<ul>
<li>根据 W3Techs 的数据，截至 2019 年 6 月，全球有 36.5% 的网站支持了 HTTP&#x2F;2</li>
</ul>
<p>下列两个网站可以进行 HTTP&#x2F;1.1 和 HTTP&#x2F;2 速度对比</p>
<ul>
<li><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="http://www.http2demo.io/" >http://www.http2demo.io/</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li>
<li><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://http2.akamai.com/demo" >https://http2.akamai.com/demo</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li>
</ul>
<p>HTTP&#x2F;2 在底层传输做了很多的改进和优化，但在语意上完全与 HTTP&#x2F;1.1 兼容</p>
<ul>
<li>比如请求方法（如 GET、POST）、Status Code、各种 Headers 等都没有改变</li>
<li>因此，要想升级到 HTTP&#x2F;2，开发者不需要修改任何代码，只需要升级服务器配置、升级浏览器</li>
</ul>

        <h2 id="2-1：HTTP-2-特性"   >
          <a href="#2-1：HTTP-2-特性" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-1：HTTP-2-特性" class="headerlink" title="2.1：HTTP&#x2F;2 特性"></a>2.1：HTTP&#x2F;2 特性</h2>
      
        <h3 id="2-1-1：二进制格式"   >
          <a href="#2-1-1：二进制格式" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-1-1：二进制格式" class="headerlink" title="2.1.1：二进制格式"></a>2.1.1：二进制格式</h3>
      <p>HTTP&#x2F;2 采用二进制格式传输数据，而非 HTTP&#x2F;1.1 的文本格式。</p>
<p>二进制格式在协议的解析和优化扩展上带来更多的优势和可能。</p>
<p><img src="/./assets/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/06/d29e722c9791418cbe4009c60216dea4.png" alt="在这里插入图片描述"></p>
<p><strong>一些基本概念</strong>：</p>
<ul>
<li><p><strong>数据流</strong>：已建立的连接内的双向字节流，可以承载一条或多条消息。<br>所有通信都在一个 TCP 连接上完成，此连接可以承载任意数量的双向数据流。</p>
</li>
<li><p><strong>消息</strong>：与逻辑 HTTP 请求或响应消息对应，由一系列帧组成。</p>
</li>
<li><p><strong>帧</strong>：HTTP&#x2F;2 通信的最小单位，每个帧都包含帧头（会标识出当前帧所属的数据流）<br>来自不同数据流的帧可以交错发送，然后再根据每个帧头的数据流标识符重新组装</p>
</li>
</ul>
<p><img src="/./assets/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/06/fcbca48699c444cbb760be0345c5189d.png" alt="在这里插入图片描述"></p>
<p><img src="/./assets/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/06/553fd2ab9ab2404081dbc8e1abf00042.png" alt="在这里插入图片描述"></p>

        <h3 id="2-1-2：多路复用"   >
          <a href="#2-1-2：多路复用" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-1-2：多路复用" class="headerlink" title="2.1.2：多路复用"></a>2.1.2：多路复用</h3>
      <p><strong>多路复用</strong>（Multiplexing），客户端和服务器可以将 HTTP 消息分解为互不依赖的帧，然后交错发送，最后再在另一端把它们重新组装起来</p>
<p><img src="/./assets/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/06/f2fe7719f8dc4355a26e46ae71591cfd.png" alt="在这里插入图片描述"></p>
<ul>
<li>并行交错地发送多个请求，请求之间互不影响</li>
<li>并行交错地发送多个响应，响应之间互不干扰</li>
<li>使用一个连接并行发送多个请求和响应</li>
</ul>
<p><img src="/./assets/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/06/5f3fd03a4a1d4bca9de8cd2c96caf62c.png" alt="在这里插入图片描述"></p>
<p>不必再为绕过 HTTP&#x2F;1.1 限制而做很多工作。比如精灵图（image sprites）、合并 CSS&#x2F;JS、内嵌 CSS&#x2F;JS&#x2F;Base64 图片、域名分片等。</p>
<blockquote>
<p>精灵图（image sprites），也叫做 CSS Sprites，将多张小图合并成一张大图。最后通过 CSS 结合小图的位置、尺寸进行精准定位。</p>
</blockquote>
<p><img src="/./assets/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/06/5d9fc86c421f419883580c426f6f79ca.png" alt="在这里插入图片描述"></p>

        <h3 id="2-1-3：优先级"   >
          <a href="#2-1-3：优先级" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-1-3：优先级" class="headerlink" title="2.1.3：优先级"></a>2.1.3：优先级</h3>
      <ul>
<li><p><strong>HTTP&#x2F;2 标准允许每个数据流都有一个关联的权重和依赖关系</strong><br>可以向每个数据流分配一个介于 1 至 256 之间的整数<br>每个数据流与其他数据流之间可以存在显式依赖关系</p>
</li>
<li><p><strong>客户端可以构建和传递 “ 优先级树 ”，表明它倾向于如何接收响应</strong></p>
</li>
<li><p><strong>服务器可以使用此信息通过控制 CPU、内存和其他资源的分配设定数据流处理的优先级</strong><br>在资源数据可用之后，确保将高优先级响应以最优方式传输至客户端</p>
</li>
</ul>
<p>示例：</p>
<p><img src="/./assets/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/06/d3873a5d0db84068a442646aa4547e3e.png" alt="在这里插入图片描述"></p>

        <h3 id="2-1-4：头部压缩"   >
          <a href="#2-1-4：头部压缩" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-1-4：头部压缩" class="headerlink" title="2.1.4：头部压缩"></a>2.1.4：头部压缩</h3>
      <p>HTTP&#x2F;2 使用 HPACK 压缩请求头和响应头，可以极大减少头部开销，进而提高性能。</p>
<blockquote>
<p>早期版本的 HTTP&#x2F;2 和 SPDY 使用 zlib 压缩请求头和响应头，可以将所传输头数据的大小减小 85% ~ 88%。<br>但在 2012 年夏天被攻击，导致会话劫持。<br>后被更安全的 HPACK 取代。</p>
</blockquote>
<p><img src="/./assets/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/06/ef4432864de24f77ad5a71f4da3beef8.png" alt="在这里插入图片描述"></p>
<p><img src="/./assets/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/06/59692cb33c7844d2a5153d165dabef2d.png" alt="在这里插入图片描述"></p>

        <h3 id="2-1-5：服务器推送"   >
          <a href="#2-1-5：服务器推送" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-1-5：服务器推送" class="headerlink" title="2.1.5：服务器推送"></a>2.1.5：服务器推送</h3>
      <p><strong>服务器推送</strong>（Server Push）：服务器可以对一个客户端请求发送多个响应。</p>
<p>除了对最初请求的响应外，服务器还可以向客户端推送额外资源，而无需客户端额外明确地请求。</p>
<p><img src="/./assets/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/06/13c2c08d06594cff8736b71c982c2843.png" alt="在这里插入图片描述"></p>

        <h2 id="2-2：HTTP-2-的问题"   >
          <a href="#2-2：HTTP-2-的问题" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-2：HTTP-2-的问题" class="headerlink" title="2.2：HTTP&#x2F;2 的问题"></a>2.2：HTTP&#x2F;2 的问题</h2>
      
        <h3 id="2-2-1：队头阻塞"   >
          <a href="#2-2-1：队头阻塞" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-2-1：队头阻塞" class="headerlink" title="2.2.1：队头阻塞"></a>2.2.1：队头阻塞</h3>
      <p>队头阻塞（head of line blocking）。</p>
<p><img src="/./assets/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/06/45e1af10bdf54f059432113e627cdbc3.png" alt="在这里插入图片描述"></p>

        <h3 id="2-2-2：握手延迟"   >
          <a href="#2-2-2：握手延迟" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-2-2：握手延迟" class="headerlink" title="2.2.2：握手延迟"></a>2.2.2：握手延迟</h3>
      <p><img src="/./assets/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/06/294da1460b764b9e871ab1d7eca220eb.png" alt="在这里插入图片描述"></p>
<blockquote>
<p>RTT（Round Trip Time）：往返时延，可以简单理解为通信一来一回的时间。</p>
</blockquote>
<p><img src="/./assets/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/06/3183c5a96e514714ab6016b5e5f97268.png" alt="在这里插入图片描述"></p>

        <h1 id="3：HTTP-3"   >
          <a href="#3：HTTP-3" class="heading-link"><i class="fas fa-link"></i></a><a href="#3：HTTP-3" class="headerlink" title="3：HTTP&#x2F;3"></a>3：HTTP&#x2F;3</h1>
      <blockquote>
<p>Google 觉得 HTTP&#x2F;2 仍然不够快，于是就有了 HTTP&#x2F;3。</p>
</blockquote>
<p>HTTP&#x2F;3 由 Google 开发，弃用 TCP 协议，改为使用基于 UDP 协议的 QUIC 协议实现。</p>
<ul>
<li>QUIC（Quick UDP Internet Connections，快速 UDP 网络连接），由 Google 在 2013 年实现</li>
<li>于 2018 年从 HTTP-over-QUIC 改为 HTTP&#x2F;3</li>
</ul>
<p><img src="/./assets/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/06/222183db4f5547cb88d63e4727c0ff4a.png" alt="在这里插入图片描述"></p>
<p><strong>思考</strong>：</p>
<p><strong>HTTP&#x2F;3 基于 UDP，如何保证可靠传输</strong>？</p>
<ul>
<li>由 QUIC 来保证</li>
</ul>
<p><strong>为何 Google 不开发一个新的不同于 TCP、UDP 的传输层协议</strong>？</p>
<ul>
<li>目前世界上的网络设备基本只认TCP、UDP</li>
<li>如果要修改传输层，意味着操作系统的内核也要修改</li>
<li>另外，由 IETF 标准化的许多 TCP 新特性都因缺乏广泛支持而没有得到广泛的部署或使用，因此，要想开发并应用一个新的传输层协议，是极其困难的一件事情</li>
</ul>

        <h2 id="3-1：HTTP-3-特性"   >
          <a href="#3-1：HTTP-3-特性" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-1：HTTP-3-特性" class="headerlink" title="3.1：HTTP&#x2F;3 特性"></a>3.1：HTTP&#x2F;3 特性</h2>
      
        <h3 id="3-1-1：连接迁移"   >
          <a href="#3-1-1：连接迁移" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-1-1：连接迁移" class="headerlink" title="3.1.1：连接迁移"></a>3.1.1：连接迁移</h3>
      <p><strong>TCP 基于 4 要素</strong>：源 IP、源端口、目标 IP、目标端口。</p>
<ul>
<li>切换网络时至少会有一个要素发生变化，导致连接发生变化</li>
<li>当连接发生变化时，如果还使用原来的 TCP 连接，则会导致连接失败，就得等原来的连接超时后重新建立连接</li>
<li>所以有时发现切换到一个新网络时，即使新网络状况良好，但内容还是需要加载很久</li>
<li>即使当检测到网络变化时立刻建立新的 TCP 连接，还是需要几百毫秒的时间</li>
</ul>
<p><strong>QUIC 的连接不受 4 要素的影响</strong>，当 4 要素发生变化时，原连接依然维持。</p>
<ul>
<li>QUIC 连接不以 4 要素作为标识，而是使用一组 Connection ID（连接ID）来标识一个连接</li>
<li>即使 IP 或者端口发生变化，只要 Connection ID 没有变化，那么连接依然可以维持</li>
</ul>
<blockquote>
<p>例如：<br>当设备连接到 Wi-Fi 时，将进行中的下载从蜂窝网络连接转移到更快速的 Wi-Fi 连接。<br>当 Wi-Fi 连接不再可用时，将连接转移到蜂窝网络连接。</p>
</blockquote>

        <h3 id="3-1-2：向前纠错"   >
          <a href="#3-1-2：向前纠错" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-1-2：向前纠错" class="headerlink" title="3.1.2：向前纠错"></a>3.1.2：向前纠错</h3>
      <blockquote>
<p>目前还没有成为标准，以后是否会成为标准也不确定。</p>
</blockquote>
<p>HTTP&#x2F;3 的向前纠错，丢包以后可以根据其他包推测出这个包的数据（只适合丢失少量数据）。</p>
<blockquote>
<p>如果是之前的基于 TPC 协议，丢包以后会重传。</p>
</blockquote>

        <h2 id="3-2：HTTP-3-的问题"   >
          <a href="#3-2：HTTP-3-的问题" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-2：HTTP-3-的问题" class="headerlink" title="3.2：HTTP&#x2F;3 的问题"></a>3.2：HTTP&#x2F;3 的问题</h2>
      <p><strong>操作系统内核、CPU 负载</strong>。</p>
<ul>
<li>Linux 内核的 UDP 部分没有像 TCP 那样的优化，因为传统上没有使用 UDP 进行如此高速的信息传输</li>
<li>TCP 和 TLS 有硬件加速，而这对于 UDP 很罕见，对于 QUIC 则基本不存在</li>
</ul>
<blockquote>
<p>据 Google 和 Facebook 称，与基于 TLS 的 HTTP&#x2F;2 相比，它们大规模部署的 QUIC 需要近 2 倍的 CPU 使用量</p>
</blockquote>
<blockquote>
<p>随着时间的推移，相信这个问题会逐步得到改善</p>
</blockquote>

        <h1 id="4：HTTP-协议的安全问题"   >
          <a href="#4：HTTP-协议的安全问题" class="heading-link"><i class="fas fa-link"></i></a><a href="#4：HTTP-协议的安全问题" class="headerlink" title="4：HTTP 协议的安全问题"></a>4：HTTP 协议的安全问题</h1>
      <p>HTTP 协议默认是采取明文传输的，因此会有很大的安全隐患。</p>
<p>常见的提高安全性的方法是：对通信内容进行加密后，再进行传输。</p>
<p>常见的加密方式：</p>
<ul>
<li>不可逆<br>单向散列函数：MD5、SHA 等</li>
<li>可逆<br>对称加密：DES、3DES、AES 等<br>非对称加密：RSA 等</li>
<li>其它<br>混合密码系统<br>数字签名<br>证书</li>
</ul>
<blockquote>
<p>encrypt：加密<br>decrypt：解密<br>plaintext：明文<br>ciphertext：密文</p>
</blockquote>
<p>为了便于学习，设计 4 个虚拟人物：</p>
<ul>
<li>Alice、Bob：互相通信</li>
<li>Eve：窃听者</li>
<li>Mallory：主动攻击者</li>
</ul>
<p><img src="/./assets/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/06/c07d318897ca420aa55a006ea9f77229.png" alt="在这里插入图片描述"></p>
<p>如何防止被窃听：</p>
<p><img src="/./assets/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/06/8089e2a8ef754372a1f7dbe021fb0f9e.png" alt="在这里插入图片描述"></p>

        <h2 id="4-1：SPDY"   >
          <a href="#4-1：SPDY" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-1：SPDY" class="headerlink" title="4.1：SPDY"></a>4.1：SPDY</h2>
      <p><strong>SPDY</strong>（speedy 的缩写），是基于 TCP 的应用层协议，它强制要求使用 SSL&#x2F;TLS。</p>
<p><img src="/./assets/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/06/432079bcfe1a4199a412eb7ee33799ac.png" alt="在这里插入图片描述"></p>
<blockquote>
<p>2009 年 11 月，Google 宣布将 SPDY 作为提高网络速度的内部项目。</p>
</blockquote>
<p>SPDY 与 HTTP 的关系：</p>
<ul>
<li>SPDY 并不用于取代 HTTP，它只是修改了 HTTP 请求与响应的传输方式</li>
<li>只需增加一个 SPDY 层，现有的所有服务端应用均不用做任何修改</li>
<li>SPDY 可以看做是 HTTP&#x2F;2 的前身</li>
</ul>

        <h1 id="5：HTTPS"   >
          <a href="#5：HTTPS" class="heading-link"><i class="fas fa-link"></i></a><a href="#5：HTTPS" class="headerlink" title="5：HTTPS"></a>5：HTTPS</h1>
      <p><strong>HTTPS</strong>（HyperText Transfer Protocol Secure，超文本传输安全协议）</p>
<ul>
<li>也称为 HTTP over TLS、HTTP over SSL、HTTP Secure</li>
<li>由网景公司于 1994 年首次提出</li>
<li>HTTPS 的默认端口号是 443（HTTP 是 80）</li>
</ul>
<blockquote>
<p>现在在浏览器上输入 <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="http://www.baidu.com/" >http://www.baidu.com</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span><br>会自动重定向到 <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://www.baidu.com/" >https://www.baidu.com</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
</blockquote>

        <h2 id="5-1：HTTPS-的成本"   >
          <a href="#5-1：HTTPS-的成本" class="heading-link"><i class="fas fa-link"></i></a><a href="#5-1：HTTPS-的成本" class="headerlink" title="5.1：HTTPS 的成本"></a>5.1：HTTPS 的成本</h2>
      <ul>
<li>证书的费用</li>
<li>加解密计算</li>
<li>降低了访问速度</li>
</ul>
<p>有些企业的做法是：包含敏感数据的请求才使用 HTTPS，其他保持使用 HTTP。</p>

        <h2 id="5-2：HTTPS-通信过程"   >
          <a href="#5-2：HTTPS-通信过程" class="heading-link"><i class="fas fa-link"></i></a><a href="#5-2：HTTPS-通信过程" class="headerlink" title="5.2：HTTPS 通信过程"></a>5.2：HTTPS 通信过程</h2>
      <p>总的可以分为 3 大阶段：</p>
<p><img src="/./assets/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/06/cf2278dbc57a44b3850075e3f6201176.png" alt="在这里插入图片描述"></p>

        <h1 id="6：SSL-TLS"   >
          <a href="#6：SSL-TLS" class="heading-link"><i class="fas fa-link"></i></a><a href="#6：SSL-TLS" class="headerlink" title="6：SSL&#x2F;TLS"></a>6：SSL&#x2F;TLS</h1>
      <p><strong>SSL</strong>（Secure Sockets Layer，安全套接层），是 TLS 的前身。</p>
<p><strong>TLS</strong>（Transport Layer Security，传输层安全性协议）。</p>
<p>HTTPS 是在 HTTP 的基础上使用 SSL&#x2F;TLS 来加密报文，对窃听和中间人攻击提供合理的防护。</p>
<p><img src="/./assets/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/06/4f0da17863844efb89e9782568ce4ef4.png" alt="在这里插入图片描述"></p>
<p>SSL&#x2F;TLS 也可以用在其他协议上，比如：</p>
<ul>
<li><code>FTP -&gt; FTPS</code></li>
<li><code>SMTP -&gt; SMTPS</code></li>
</ul>
<p>SSL&#x2F;TLS 历史版本信息</p>
<ul>
<li>SSL 1.0：因存在严重的安全漏洞，从未公开过</li>
<li>SSL 2.0：1995 年，已于 2011 年弃用（<span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://www.rfc-editor.org/rfc/rfc6176" >RFC 6176</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>）</li>
<li>SSL 3.0：1996 年，已于 2015 年弃用（<span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://www.rfc-editor.org/rfc/rfc7568" >RFC 7568</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>）</li>
<li>TLS 1.0：1999 年（<span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://www.rfc-editor.org/rfc/rfc2246" >RFC 2246</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>）</li>
<li>TLS 1.1：2006 年（<span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://www.rfc-editor.org/rfc/rfc4346" >RFC 4346</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>）</li>
<li>TLS 1.2：2008 年（<span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://www.rfc-editor.org/rfc/rfc5246" >RFC 5246</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>）</li>
<li>TLS 1.3：2018 年（<span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://www.rfc-editor.org/rfc/rfc8446" >RFC 8446</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>）</li>
</ul>

        <h2 id="6-1：SSL-TLS-工作在哪一层"   >
          <a href="#6-1：SSL-TLS-工作在哪一层" class="heading-link"><i class="fas fa-link"></i></a><a href="#6-1：SSL-TLS-工作在哪一层" class="headerlink" title="6.1：SSL&#x2F;TLS 工作在哪一层"></a>6.1：SSL&#x2F;TLS 工作在哪一层</h2>
      <p><img src="/./assets/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/06/9733cbb1f09e431eb2ec3522657eb618.png" alt="在这里插入图片描述"></p>

        <h2 id="6-2：TLS-1-2-的连接"   >
          <a href="#6-2：TLS-1-2-的连接" class="heading-link"><i class="fas fa-link"></i></a><a href="#6-2：TLS-1-2-的连接" class="headerlink" title="6.2：TLS 1.2 的连接"></a>6.2：TLS 1.2 的连接</h2>
      <p>TLS 1.2 的连接（ECDHE 密钥交换算法）大概有 10 大步骤。</p>
<p>下图中省略了中间产生的一些 ACK 确认。</p>
<p><img src="/./assets/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/06/9a7699c3399f408d9e898ff83a36bbc0.png" alt="在这里插入图片描述"></p>

        <h3 id="6-2-1：Client-Hello"   >
          <a href="#6-2-1：Client-Hello" class="heading-link"><i class="fas fa-link"></i></a><a href="#6-2-1：Client-Hello" class="headerlink" title="6.2.1：Client Hello"></a>6.2.1：Client Hello</h3>
      <ul>
<li>TLS 的版本号</li>
<li>支持的加密组件（Cipher Suite）列表<br>加密组件是指所使用的加密算法及密钥长度等</li>
<li>一个随机数（Client Random）</li>
</ul>
<p><img src="/./assets/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/06/14cbc7e4a8d942aa9111148d4e3b8587.png" alt="在这里插入图片描述"></p>

        <h3 id="6-2-2：Server-Hello"   >
          <a href="#6-2-2：Server-Hello" class="heading-link"><i class="fas fa-link"></i></a><a href="#6-2-2：Server-Hello" class="headerlink" title="6.2.2：Server Hello"></a>6.2.2：Server Hello</h3>
      <ul>
<li>TLS 的版本号</li>
<li>选择的加密组件<br>是从接收到的客户端加密组件列表中挑选出来的</li>
<li>一个随机数（Server Random）</li>
</ul>
<p><img src="/./assets/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/06/b8287b7017324c7386a66b87711a44b2.png" alt="在这里插入图片描述"></p>

        <h3 id="6-2-3：Certificate"   >
          <a href="#6-2-3：Certificate" class="heading-link"><i class="fas fa-link"></i></a><a href="#6-2-3：Certificate" class="headerlink" title="6.2.3：Certificate"></a>6.2.3：Certificate</h3>
      <ul>
<li>服务器的公钥证书（被 CA 签名过的）</li>
</ul>
<p><img src="/./assets/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/06/e756425dfd764cdfbc99aa5afbcaa491.png" alt="在这里插入图片描述"></p>

        <h3 id="6-2-4：Server-Key-Exchange"   >
          <a href="#6-2-4：Server-Key-Exchange" class="heading-link"><i class="fas fa-link"></i></a><a href="#6-2-4：Server-Key-Exchange" class="headerlink" title="6.2.4：Server Key Exchange"></a>6.2.4：Server Key Exchange</h3>
      <ul>
<li>用以实现 ECDHE 算法的其中一个参数（Server Params）<br>ECDHE 是一种密钥交换算法<br>为了防止伪造，Server Params 经过了服务器私钥签名</li>
</ul>
<p><img src="/./assets/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/06/2af02c8cea194d86b5edb0e6386e3908.png" alt="在这里插入图片描述"></p>

        <h3 id="6-2-5：Server-Hello-Done"   >
          <a href="#6-2-5：Server-Hello-Done" class="heading-link"><i class="fas fa-link"></i></a><a href="#6-2-5：Server-Hello-Done" class="headerlink" title="6.2.5：Server Hello Done"></a>6.2.5：Server Hello Done</h3>
      <ul>
<li>告知客户端：协商部分结束</li>
</ul>
<p><img src="/./assets/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/06/5cc628fdc40e4e68ab7032ee40f8cf3c.png" alt="在这里插入图片描述"></p>
<p>到目前为止，客户端和服务器之间通过明文共享了：</p>
<ul>
<li>Client Random</li>
<li>Server Random</li>
<li>Server Params</li>
</ul>
<p>而且，客户端也已经拿到了服务器的公钥证书，接下来，客户端会验证证书的真实有效性。</p>

        <h3 id="6-2-6：Client-Key-Exchange"   >
          <a href="#6-2-6：Client-Key-Exchange" class="heading-link"><i class="fas fa-link"></i></a><a href="#6-2-6：Client-Key-Exchange" class="headerlink" title="6.2.6：Client Key Exchange"></a>6.2.6：Client Key Exchange</h3>
      <ul>
<li>用以实现 ECDHE 算法的另一个参数（Client Params）</li>
</ul>
<p><img src="/./assets/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/06/0d0f51dc81b74a6b95d0d324685e3503.png" alt="在这里插入图片描述"></p>
<p>目前为止，客户端和服务器都拥有了 ECDHE 算法需要的 2 个参数：</p>
<ul>
<li>Server Params</li>
<li>Client Params</li>
</ul>
<p>客户端、服务器都可以使用 ECDHE 算法根据 Server Params、Client Params 计算出一个新的随机密钥串：Pre-master secret。</p>
<p>然后结合 Client Random、Server Random、Pre-master secret 生成一个主密钥。</p>
<p>最后利用主密钥衍生出其他密钥：客户端发送用的会话密钥、服务器发送用的会话密钥等。</p>

        <h3 id="6-2-7：Change-Cipher-Spec"   >
          <a href="#6-2-7：Change-Cipher-Spec" class="heading-link"><i class="fas fa-link"></i></a><a href="#6-2-7：Change-Cipher-Spec" class="headerlink" title="6.2.7：Change Cipher Spec"></a>6.2.7：Change Cipher Spec</h3>
      <ul>
<li>告知服务器：之后的通信会采用计算出来的会话密钥进行加密</li>
</ul>
<p><img src="/./assets/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/06/a0127996591c4a708340ddf4491135ac.png" alt="在这里插入图片描述"></p>

        <h3 id="6-2-8：Finished（Client）"   >
          <a href="#6-2-8：Finished（Client）" class="heading-link"><i class="fas fa-link"></i></a><a href="#6-2-8：Finished（Client）" class="headerlink" title="6.2.8：Finished（Client）"></a>6.2.8：Finished（Client）</h3>
      <ul>
<li>包含连接至今全部报文的整体校验值（摘要），加密之后发送给服务器</li>
<li>这次握手协商是否成功，要以服务器是否能够正确解密该报文作为判定标准</li>
</ul>
<p><img src="/./assets/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/06/5bada67b8825425d92f6fb3ace9323a7.png" alt="在这里插入图片描述"></p>

        <h3 id="6-2-9：Change-Cipher-Spec"   >
          <a href="#6-2-9：Change-Cipher-Spec" class="heading-link"><i class="fas fa-link"></i></a><a href="#6-2-9：Change-Cipher-Spec" class="headerlink" title="6.2.9：Change Cipher Spec"></a>6.2.9：Change Cipher Spec</h3>
      <p><img src="/./assets/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/06/a0113b991dfe470daedd836ddeb63e24.png" alt="在这里插入图片描述"></p>

        <h3 id="6-2-10：Finished（Server）"   >
          <a href="#6-2-10：Finished（Server）" class="heading-link"><i class="fas fa-link"></i></a><a href="#6-2-10：Finished（Server）" class="headerlink" title="6.2.10：Finished（Server）"></a>6.2.10：Finished（Server）</h3>
      <ul>
<li>到此为止，客户端服务器都验证加密解密没问题，握手正式结束</li>
<li>后面开始传输加密的 HTTP 请求和响应</li>
</ul>
<p><img src="/./assets/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/06/76cf716e4a3c49fba7544627100f2829.png" alt="在这里插入图片描述"></p>

        <h2 id="6-3：OpenSSL"   >
          <a href="#6-3：OpenSSL" class="heading-link"><i class="fas fa-link"></i></a><a href="#6-3：OpenSSL" class="headerlink" title="6.3：OpenSSL"></a>6.3：OpenSSL</h2>
      <p><strong>OpenSSL</strong> 是 SSL&#x2F;TLS 协议的开源实现，始于 1998 年，支持 Windows、Mac、Linux 等平台。</p>
<p>官网：<span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://www.openssl.org/" >https://www.openssl.org/</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<blockquote>
<p>Linux、Mac 一般自带 OpenSSL。<br>Windows 下载安装 OpenSSL：<span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://www.openssl.org/source/" >https://www.openssl.org/source/</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
</blockquote>
<p><strong>常用命令</strong>：</p>
<p><strong>生成私钥</strong>：<br><code>openssl genrsa -out my.key</code></p>
<p><strong>生成公钥</strong>：<br><code>openssl rsa -in my.key -pubout -out my.pem</code></p>
<p>可以使用 OpenSSL 构建一套属于自己的 CA，自己给自己颁发证书，称为 “ 自签名证书 ”。</p>
<p>除此以外，一个生成免费证书的网站：<span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://freessl.org/" >https://freessl.org</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<hr>
<p><font color="#20B2AA">
人生如逆旅，我亦是行人。
</font></p>
<p align="right"><font color="#20B2AA">
——《临江仙 · 送钱穆父》（宋）苏轼
</font></p>

</div><footer class="post-footer"><div class="post-ending ending"><div class="ending__text">------ 本文结束，感谢您的阅读 ------</div></div><div class="post-copyright copyright"><div class="copyright-author"><span class="copyright-author__name">本文作者: </span><span class="copyright-author__value"><a href="https://blog.lens-shrine.top">镜坛主</a></span></div><div class="copyright-link"><span class="copyright-link__name">本文链接: </span><span class="copyright-link__value"><a href="https://blog.lens-shrine.top/2022/10/06/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/%E3%80%8A%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E3%80%8B06.%20HTTP%20%E8%A1%A5%E5%85%85%20%C2%B7%20HTTPS%20%C2%B7%20SSL_TLS/">https://blog.lens-shrine.top/2022/10/06/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/%E3%80%8A%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E3%80%8B06.%20HTTP%20%E8%A1%A5%E5%85%85%20%C2%B7%20HTTPS%20%C2%B7%20SSL_TLS/</a></span></div><div class="copyright-notice"><span class="copyright-notice__name">版权声明: </span><span class="copyright-notice__value">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" rel="external nofollow" target="_blank">BY-NC-SA</a> 许可协议。转载请注明出处！</span></div></div><nav class="post-paginator paginator"><div class="paginator-prev"><a class="paginator-prev__link" href="/2022/10/08/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/%E3%80%8A%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E3%80%8B07.%20%E5%85%B6%E4%BB%96%E5%8D%8F%E8%AE%AE/"><span class="paginator-prev__icon"><i class="fas fa-angle-left"></i></span><span class="paginator-prev__text">《网络协议》07. 其他协议</span></a></div><div class="paginator-next"><a class="paginator-next__link" href="/2022/09/10/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/%E3%80%8A%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E3%80%8B05.%20%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1%E5%AE%89%E5%85%A8%20%C2%B7%20%E5%AF%86%E7%A0%81%E6%8A%80%E6%9C%AF/"><span class="paginator-prev__text">《网络协议》05. 网络通信安全 · 密码技术</span><span class="paginator-next__icon"><i class="fas fa-angle-right"></i></span></a></div></nav></footer></div></div></div><div class="sidebar-wrap" id="sidebar-wrap"><aside class="sidebar" id="sidebar"><div class="sidebar-nav"><span class="sidebar-nav-toc current">文章目录</span><span class="sidebar-nav-ov">站点概览</span></div><section class="sidebar-toc"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1%EF%BC%9AHTTP-1-1-%E5%8D%8F%E8%AE%AE%E7%9A%84%E4%B8%8D%E8%B6%B3"><span class="toc-text">
          1：HTTP&#x2F;1.1 协议的不足</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2%EF%BC%9AHTTP-2"><span class="toc-text">
          2：HTTP&#x2F;2</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1%EF%BC%9AHTTP-2-%E7%89%B9%E6%80%A7"><span class="toc-text">
          2.1：HTTP&#x2F;2 特性</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-1%EF%BC%9A%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%A0%BC%E5%BC%8F"><span class="toc-text">
          2.1.1：二进制格式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-2%EF%BC%9A%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8"><span class="toc-text">
          2.1.2：多路复用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-3%EF%BC%9A%E4%BC%98%E5%85%88%E7%BA%A7"><span class="toc-text">
          2.1.3：优先级</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-4%EF%BC%9A%E5%A4%B4%E9%83%A8%E5%8E%8B%E7%BC%A9"><span class="toc-text">
          2.1.4：头部压缩</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-5%EF%BC%9A%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%8E%A8%E9%80%81"><span class="toc-text">
          2.1.5：服务器推送</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2%EF%BC%9AHTTP-2-%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-text">
          2.2：HTTP&#x2F;2 的问题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-1%EF%BC%9A%E9%98%9F%E5%A4%B4%E9%98%BB%E5%A1%9E"><span class="toc-text">
          2.2.1：队头阻塞</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-2%EF%BC%9A%E6%8F%A1%E6%89%8B%E5%BB%B6%E8%BF%9F"><span class="toc-text">
          2.2.2：握手延迟</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3%EF%BC%9AHTTP-3"><span class="toc-text">
          3：HTTP&#x2F;3</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1%EF%BC%9AHTTP-3-%E7%89%B9%E6%80%A7"><span class="toc-text">
          3.1：HTTP&#x2F;3 特性</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-1%EF%BC%9A%E8%BF%9E%E6%8E%A5%E8%BF%81%E7%A7%BB"><span class="toc-text">
          3.1.1：连接迁移</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-2%EF%BC%9A%E5%90%91%E5%89%8D%E7%BA%A0%E9%94%99"><span class="toc-text">
          3.1.2：向前纠错</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2%EF%BC%9AHTTP-3-%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-text">
          3.2：HTTP&#x2F;3 的问题</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4%EF%BC%9AHTTP-%E5%8D%8F%E8%AE%AE%E7%9A%84%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98"><span class="toc-text">
          4：HTTP 协议的安全问题</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1%EF%BC%9ASPDY"><span class="toc-text">
          4.1：SPDY</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5%EF%BC%9AHTTPS"><span class="toc-text">
          5：HTTPS</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#5-1%EF%BC%9AHTTPS-%E7%9A%84%E6%88%90%E6%9C%AC"><span class="toc-text">
          5.1：HTTPS 的成本</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-2%EF%BC%9AHTTPS-%E9%80%9A%E4%BF%A1%E8%BF%87%E7%A8%8B"><span class="toc-text">
          5.2：HTTPS 通信过程</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#6%EF%BC%9ASSL-TLS"><span class="toc-text">
          6：SSL&#x2F;TLS</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#6-1%EF%BC%9ASSL-TLS-%E5%B7%A5%E4%BD%9C%E5%9C%A8%E5%93%AA%E4%B8%80%E5%B1%82"><span class="toc-text">
          6.1：SSL&#x2F;TLS 工作在哪一层</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-2%EF%BC%9ATLS-1-2-%E7%9A%84%E8%BF%9E%E6%8E%A5"><span class="toc-text">
          6.2：TLS 1.2 的连接</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-1%EF%BC%9AClient-Hello"><span class="toc-text">
          6.2.1：Client Hello</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-2%EF%BC%9AServer-Hello"><span class="toc-text">
          6.2.2：Server Hello</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-3%EF%BC%9ACertificate"><span class="toc-text">
          6.2.3：Certificate</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-4%EF%BC%9AServer-Key-Exchange"><span class="toc-text">
          6.2.4：Server Key Exchange</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-5%EF%BC%9AServer-Hello-Done"><span class="toc-text">
          6.2.5：Server Hello Done</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-6%EF%BC%9AClient-Key-Exchange"><span class="toc-text">
          6.2.6：Client Key Exchange</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-7%EF%BC%9AChange-Cipher-Spec"><span class="toc-text">
          6.2.7：Change Cipher Spec</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-8%EF%BC%9AFinished%EF%BC%88Client%EF%BC%89"><span class="toc-text">
          6.2.8：Finished（Client）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-9%EF%BC%9AChange-Cipher-Spec"><span class="toc-text">
          6.2.9：Change Cipher Spec</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-10%EF%BC%9AFinished%EF%BC%88Server%EF%BC%89"><span class="toc-text">
          6.2.10：Finished（Server）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-3%EF%BC%9AOpenSSL"><span class="toc-text">
          6.3：OpenSSL</span></a></li></ol></li></ol></section><!-- ov = overview--><section class="sidebar-ov hide"><div class="sidebar-ov-author"><div class="sidebar-ov-author__avatar"><img class="sidebar-ov-author__avatar_img" src="/images/icons/notAlone.png" alt="avatar"></div><p class="sidebar-ov-author__text">但愿五湖明月在。</p></div><div class="sidebar-ov-state"><a class="sidebar-ov-state-item sidebar-ov-state-item--posts" href="/archives/"><div class="sidebar-ov-state-item__count">34</div><div class="sidebar-ov-state-item__name">归档</div></a><a class="sidebar-ov-state-item sidebar-ov-state-item--categories" href="/categories/"><div class="sidebar-ov-state-item__count">7</div><div class="sidebar-ov-state-item__name">分类</div></a></div><div class="sidebar-ov-cc"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" target="_blank" rel="noopener" data-popover="知识共享许可协议" data-popover-pos="up"><img src="/images/cc-by-nc-sa.svg"></a></div></section><div class="sidebar-reading"><div class="sidebar-reading-info"><span class="sidebar-reading-info__text">你已阅读了 </span><span class="sidebar-reading-info__num">0</span><span class="sidebar-reading-info__perc">%</span></div><div class="sidebar-reading-line"></div></div></aside></div><div class="clearfix"></div></div></main><footer class="footer" id="footer"><div class="footer-inner"><div><span>Copyright © 2022~2024</span><span class="footer__icon"><i class="fas fa-heart"></i></span><span>镜坛主</span></div><div>欢迎来到 —— 镜坛！</div></div></footer><div class="loading-bar" id="loading-bar"><div class="loading-bar__progress"></div></div><div class="back2top" id="back2top"><span class="back2top__icon"><i class="fas fa-rocket"></i></span></div></div><script src="https://cdn.jsdelivr.net/npm/jquery@v3.4.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.ui.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax@latest/pjax.min.js"></script><script>window.addEventListener('DOMContentLoaded', function () {
  var pjax = new Pjax({"selectors":["head title","#main",".pjax-reload",".header-banner"],"history":true,"scrollTo":false,"scrollRestoration":false,"cacheBust":false,"debug":false,"currentUrlFullReload":false,"timeout":0});
  // 加载进度条的计时器
  var loadingTimer = null;

  // 重置页面 Y 方向上的滚动偏移量
  document.addEventListener('pjax:send', function () {
    $('.header-nav-menu').removeClass('show');
    if (CONFIG.pjax && CONFIG.pjax.avoidBanner) {
      $('html').velocity('scroll', {
        duration: 500,
        offset: $('#header').height(),
        easing: 'easeInOutCubic'
      });
    }

    var loadingBarWidth = 20;
    var MAX_LOADING_WIDTH = 95;

    $('.loading-bar').addClass('loading');
    $('.loading-bar__progress').css('width', loadingBarWidth + '%');
    clearInterval(loadingTimer);
    loadingTimer = setInterval(function () {
      loadingBarWidth += 3;
      if (loadingBarWidth > MAX_LOADING_WIDTH) {
        loadingBarWidth = MAX_LOADING_WIDTH;
      }
      $('.loading-bar__progress').css('width', loadingBarWidth + '%');
    }, 500);
  }, false);

  window.addEventListener('pjax:complete', function () {
    clearInterval(loadingTimer);
    $('.loading-bar__progress').css('width', '100%');
    $('.loading-bar').removeClass('loading');
    setTimeout(function () {
      $('.loading-bar__progress').css('width', '0');
    }, 400);
    $('link[rel=prefetch], script[data-pjax-rm]').each(function () {
      $(this).remove();
    });
    $('script[data-pjax], #pjax-reload script').each(function () {
      $(this).parent().append($(this).remove());
    });

    if (Stun.utils.pjaxReloadBoot) {
      Stun.utils.pjaxReloadBoot();
    }
    if (Stun.utils.pjaxReloadScroll) {
      Stun.utils.pjaxReloadScroll();
    }
    if (Stun.utils.pjaxReloadSidebar) {
      Stun.utils.pjaxReloadSidebar();
    }
    if (false) {
      if (Stun.utils.pjaxReloadHeader) {
        Stun.utils.pjaxReloadHeader();
      }
      if (Stun.utils.pjaxReloadScrollIcon) {
        Stun.utils.pjaxReloadScrollIcon();
      }
      if (Stun.utils.pjaxReloadLocalSearch) {
        Stun.utils.pjaxReloadLocalSearch();
      }
    }
  }, false);
}, false);</script><div id="pjax-reload"></div><script src="/js/utils.js?v=2.8.0"></script><script src="/js/stun-boot.js?v=2.8.0"></script><script src="/js/scroll.js?v=2.8.0"></script><script src="/js/header.js?v=2.8.0"></script><script src="/js/web-effect-click.js?v=2.8.0"></script><script src="/js/web-effect-flower.js?v=2.8.0"></script><script src="/js/sidebar.js?v=2.8.0"></script></body></html>